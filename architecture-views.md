# Основные представления архитектуры

## Функциональное представление

Отражает что система делает:

1. **Управление профилем:** регистрация, настройки, инвентарь.
2. **Трекинг активности:** запись, обогащение, хранение тренировок.
3. **Планирование тренировок:** генерация, напоминания, адаптация.
4. **Социальное взаимодействие:** поиск, группы, события.
5. **Мотивация:** достижения, рейтинги, челленджи.
6. **Персонализированный контент:** промо, новости, рекомендации.
7. **Интеграция с продажами:** seamless переход в e-commerce.

## Информационное представление

1. Пользователь → имеет → Инвентарь, Активность, Достижения
2. Активность → содержит → Маршрут, Метрики, Устройство
3. Пользователь ↔ Пользователь (через Дружба/Группа)
4. Активность → триггер → Событие → Gamification / Promo / Commerce
5. Все персональные данные зашифрованы и доступны только по авторизованному запросу.

## Многозадачность (Concurrency)

1. **Мобильное приложение:** многопоточно записывает GPS, ЧСС, акселерометр.
2. **Сервер:** обрабатывает события асинхронно через Kafka-консьюмеры (параллельные группы по типу событий).
3. **ClickHouse:** оптимизирован для параллельного чтения агрегатов (рейтинги, сравнения).
4. **Neo4j:** поддерживает конкурентные read/write для соц. графа.
5. **Блокировки:** только на уровне бизнес-транзакций (например, обновление износа обуви — atomic).

## Инфраструктурное представление

1. **Вычисления:** Kubernetes-кластеры в AWS, GCP, Azure.
2. **Хранение:**
    - PostgreSQL (AWS RDS / GCP Cloud SQL) — профили
    - Neo4j (self-hosted или Aura) — соц. граф
    - ClickHouse (managed: Altinity или Yandex) — активность
3. **Сети:** private VPC/VNet, API Gateway, TLS everywhere.
4. **Мониторинг:** Prometheus + Grafana + Loki + Tempo (OpenTelemetry).
5. **CI/CD:** GitOps (ArgoCD), feature flags, canary-релизы.

## Безопасность

1. Аутентификация: OAuth 2.0 / OpenID Connect через Auth Core.
2. Авторизация: RBAC + ABAC (на основе согласий).
3. Данные:
   - Шифрование AES-256 в покое, TLS 1.3+ в передаче.
   - Геолокация и health-данные — отдельные категории с повышенной защитой.
4. Сетевая безопасность:
   - Zero Trust: все сервисы в приватных подсетях.
   - WAF на входе, mTLS между сервисами.
5. Соответствие:
   - Все согласия хранятся и логируются.
   - Полный аудит-трейл для операций с PII.
   - Ежеквартальные pentest и SOC 2 Type II аудиты.

# Анализ архитектурных опций и обоснование выбора

### Критерии оценки архитектурных решений

Для выбора архитектуры использовались следующие ключевые критерии, вытекающие из бизнес-целей и требований:

1. **Масштабируемость** — поддержка 100K+ одновременных пользователей и массовых соревнований.
2. **Гибкость и скорость разработки** — возможность независимого развёртывания командами в разных регионах и на разных стеках.
3. **Соблюдение приватности и безопасности** — строгий контроль доступа к данным о здоровье и геолокации.
4. **Multi-cloud поддержка** — отсутствие vendor lock-in.
5. **Наблюдаемость и отказоустойчивость** — в условиях распределённой инфраструктуры.
6. **Стоимость владения (TCO)** — баланс между производительностью, сложностью и затратами.

### Сравнение архитектурных подходов

| Архитектурная опция                      | Плюсы                                                                                                                                                                                                                                                                                                               | Минусы                                                                                                                                                                                  | Соответствие критериям                                                                              |
|------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| **Монолит**                              | • Простота разработки на старте<br>• Единая БД — легко обеспечить согласованность                                                                                                                                                                                                                                   | • Плохая масштабируемость под нагрузкой<br>• Тесная связность — трудно вносить изменения<br>• Невозможно распределить команды по доменам<br>• Сложно соблюдать multi-cloud стратегию    | ✘ Масштабируемость<br>✘ Гибкость<br>✘ Multi-cloud                                                   |
| **REST-based Microservices**             | • Независимость команд и сервисов<br>• Хорошая масштабируемость<br>• Чёткие границы доменов                                                                                                                                                                                                                         | • Сложность согласованности данных<br>• Высокая задержка при цепочках вызовов<br>• Сложность отладки распределённых транзакций                                                          | ✔ Гибкость<br>✔ Multi-cloud<br>△ Наблюдаемость (требует усилий)                                     |
| **Event-Driven Microservices** (выбрано) | • Высокая масштабируемость и отказоустойчивость<br>• Асинхронность — устойчивость к пикам нагрузки<br>• Естественная поддержка аналитики и реактивных фич (например, уведомлений)<br>• Легко реализовать eventual consistency для соц. графа и активности<br>• Отлично сочетается с multi-cloud и managed-сервисами | • Повышенная сложность проектирования<br>• Требуется event bus (Kafka/Pulsar)<br>• Нужна культура observability                                                                         | ✔✔ Масштабируемость<br>✔✔ Гибкость<br>✔✔ Наблюдаемость (при правильной реализации)<br>✔ Multi-cloud |
| **Serverless (FaaS)**                    | • Автомасштабирование «из коробки»<br>• Оплата только за использование<br>• Быстрый запуск отдельных функций                                                                                                                                                                                                        | • Cold starts — неприемлемы для latency-sensitive сценариев<br>• Сложность stateful-логики (например, сессии тренировок)<br>• Сильный vendor lock-in<br>• Ограниченное время выполнения | ✘ Multi-cloud<br>△ Безопасность (ограниченный контроль)<br>✘ Сложные домены (соц. граф, тренировки) |

### Почему выбрана Event-Driven Microservices?

#### 1. Соответствие бизнес-модели:
Платформа строится вокруг событий — завершение тренировки, достижение, публикация, покупка. 
Event-driven подход естественно отражает эту логику и позволяет легко добавлять новые реакции на события (например, «если пробежал 50 км → предложи скидку»).

#### 2. Поддержка пиковых нагрузок:
Соревнования и челленджи создают всплески активности. Асинхронная обработка через Kafka/Pulsar позволяет буферизировать нагрузку и обрабатывать её без потерь.
#### 3. Гибкость команд и технологий:
Команды в разных странах могут разрабатывать сервисы на разных языках (Go для Tracking, Kotlin для Social, Python для ML), используя подходящие БД (PostgreSQL, Neo4j, ClickHouse) — без влияния на остальную систему.
#### 4. Multi-cloud без компромиссов:
Каждый сервис можно размещать в том облаке, где он наиболее эффективен (например, аналитика — в GCP, граф — в Azure), а event bus работает поверх сетей провайдеров.
#### 5. Наблюдаемость на уровне событий:
Каждое событие — трассируемый объект. Это упрощает диагностику, аудит и построение аналитических витрин.
#### 6. Безопасность через изоляцию:
Данные о здоровье (в Activity Service) и социальные связи (в Social Graph) хранятся отдельно, с разными политиками доступа — что соответствует принципу минимальных привилегий.


## Итог

**Event-Driven Microservices** — единственный подход, который одновременно удовлетворяет:

* требованиям масштабируемости и надёжности при глобальной нагрузке,
* необходимости гибкой разработки в большой распределённой компании,
* строгим юридическим и этическим требованиям к данным,
* стратегической цели построения реактивной, персонализированной экосистемы.
